!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):e(jQuery)}((function(e){var i,n=e(window).width(),l=e(window).height(),o=[];e(window).resize((function(){clearTimeout(i),i=setTimeout((function(){e(window).width()===n&&e(window).height()===l||(e(o).each((function(){e(this).flexMenu({undo:!0}).flexMenu(this.options)})),n=e(window).width(),l=e(window).height())}),200)})),e.fn.flexMenu=function(i){var n,l=e.extend({threshold:2,cutoff:2,linkText:"More",linkTextAll:"Menu",shouldApply:function(){return!0},showOnHover:!0,popupAbsolute:!0,popupClass:"",undo:!1,showCount:!1,hOverflow:!1,disableClick:!1,linkClass:""},i);return this.options=l,(n=e.inArray(this,o))>=0?o.splice(n,1):o.push(this),this.each((function(){var i,n,o,t,a,s,d,r=e(this),f=r.find("> li"),u=f.first(),h=f.last(),p=f.length,c=Math.floor(u.offset().top),w=Math.floor(u.outerHeight(!0)),v=!1;function M(e){var i=Math.ceil(e.offset().top)>=c+w;return!0===l.hOverflow&&!0!==i&&Math.ceil(e.offset().left)+Math.ceil(e.outerWidth())>=Math.floor(u.offset().left)+Math.floor(e.parent().width())&&(i=!0),i}if(M(h)&&p>l.threshold&&!l.undo&&r.is(":visible")&&l.shouldApply()){var C=e('<ul class="flexMenu-popup dropdown-menu"'+(!0!==l.disableClick?'style="display:none;'+(l.popupAbsolute?" position: absolute;":"")+'"':"")+"></ul>");for(C.addClass(l.popupClass),d=p;d>1;d--){if(n=M(i=r.find("> li:last-child")),d-1<=l.cutoff){e(r.children().get().reverse()).appendTo(C),v=!0;break}if(!n)break;i.appendTo(C)}v?r.append('<li class="flexMenu-viewMore flexMenu-allInPopup"><a href="#" '+(!0!==l.disableClick?' data-toggle="dropdown"':"")+' aria-haspopup="true" aria-expanded="false">'+l.linkTextAll+"</a></li>"):r.append('<li class="flexMenu-viewMore"><a href="#" href="#"'+(!0!==l.disableClick?' data-toggle="dropdown"':"")+' aria-haspopup="true" aria-expanded="false">'+l.linkText+"</a></li>"),(o=r.find("> li.flexMenu-viewMore")).addClass(l.linkClass),M(o)&&r.find("> li:nth-last-child(2)").appendTo(C),C.children().each((function(e,i){C.prepend(i)})),o.append(C),t=r.find("> li.flexMenu-viewMore > a"),!0===l.showCount&&t.append('<span class="count">'+C.children().length+"</span>"),C.children().each((function(){(e(this).hasClass("selected")||e(this).hasClass("current")||e(this).hasClass("current-menu-item"))&&o.addClass("has-current")})),t.on("click",(function(i){var n;!0!==l.disableClick&&(n=o,e("li.flexMenu-viewMore.active").not(n).removeClass("active").find("> ul").hide(),C.toggle(),o.toggleClass("active")),i.preventDefault()})),l.showOnHover&&"undefined"!=typeof Modernizr&&!Modernizr.touch&&o.hover((function(){C.show(),e(this).addClass("active")}),(function(){C.hide(),e(this).removeClass("active")})),!0!==l.disableClick&&e("body").on("mousedown",(function(e){C.is(e.target)||0!==C.has(e.target).length||(C.hide(),o.removeClass("active"))}))}else if(l.undo&&r.find("ul.flexMenu-popup")){for(a=(s=r.find("ul.flexMenu-popup")).find("li").length,d=1;d<=a;d++)s.find("> li:first-child").appendTo(r);s.remove(),r.find("> li.flexMenu-viewMore").remove()}}))}}));
